<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Users</title>
    <link rel="stylesheet" href="../css/users.css"> 

<script>
    function deleteUser(userId) {
        fetch(`/user/${userId}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            if (data.success) {
                alert("User deleted successfully");
                window.location.reload();
            } else {
                throw new Error('User deletion failed');
            }
        })
        .catch(error => {
            alert("Error deleting user");
            console.error('There was a problem with the fetch operation:', error.message);
        });
    }

    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.delete-button').forEach(button => {
            button.addEventListener('click', function() {
                const userId = this.getAttribute('data-user-id');
                deleteUser(userId);
            });
        });
    });
</script>
</head>
<body>

<div class="table-container">
    <input type="text" id="searchInput" placeholder="Search for users..">
    <a href="/add_user" class="add-button">ADD</a> 

    <button onclick="deleteUser()">Click me</button>

    <table id="userTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Firstname</th>
                <th>Lastname</th>
                <th>Email</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td>{{ data.id }}</td>
                <td>{{ data.firstname }}</td>
                <td>{{ data.lastname }}</td>
                <td>{{ data.email }}</td>
                <td>
                    <input type="hidden" class="userId" value="{{ user.id }}">
                    <button class="delete-button" data-user-id="{{user.id}}">DELETE</button>
                    <button class="update-button">UPDATE</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
</body>
</html>