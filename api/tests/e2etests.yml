# api/tests/e2etests.yml
name: API E2E Tests

vars:
  sql_ip: ""
  api_ip: ""

testcases:
  - name: Fetch DB Container IP
    steps:
      - type: exec
        script: docker inspect -f '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' cv_db-container
        assertions:
          - result.code ShouldEqual 0
        extract:
          sql_ip: result.systemout

  - name: Fetch API Container IP
    steps:
      - type: exec
        script: docker inspect -f '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' cv_api-container
        assertions:
          - result.code ShouldEqual 0
        extract:
          api_ip: result.systemout

  - name: DeleteUser
    steps:
      - type: http
        method: DELETE
        # url: "http://cv_api-service:8080/user/2" only if manualy solve ip
        # url: "http://172.26.0.3:8080/user/5"  # merge
        url: "http://{{.api_ip}}:8080/user/7" # merge
        headers:
          Content-Type: application/json
        assertions:
          - result.statuscode ShouldEqual 204
